<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Desafio dos Depósitos</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <h1>Desafio dos Depósitos</h1>
    
    <p>Valor total depositado: <span id="total">0</span> R$</p>

    <div class="deposits-container">
        <!-- Os depósitos serão gerados aqui pelo JavaScript -->
    </div>

    <!-- Botão para resetar os depósitos -->
    <button id="resetButton">Resetar</button>

    <!-- Inclua os scripts do Firebase -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-app.js";
        import { getDatabase, ref, set, get, child } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-database.js";

        // Configuração do Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyDoF06G0K4C6DkiKBLdr7BECgOJW7vXmGA",
            authDomain: "planejamento-f5fe7.firebaseapp.com",
            projectId: "planejamento-f5fe7",
            storageBucket: "planejamento-f5fe7.firebasestorage.app",
            messagingSenderId: "207138969970",
            appId: "1:207138969970:web:410110bef88c58fb76a5eb",
            measurementId: "G-N4LLKSEBS2"
        };

        // Inicializar Firebase
        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);

        let totalDepositado = 0;

        // Função para recuperar dados salvos do Firebase
        function carregarDados() {
            const depositosRef = ref(database, 'depositos');
            get(depositosRef).then((snapshot) => {
                if (snapshot.exists()) {
                    const dados = snapshot.val();
                    totalDepositado = dados.total;
                    atualizarTotal();

                    // Marca os depósitos já feitos
                    if (dados.numerosSelecionados) {
                        dados.numerosSelecionados.forEach(num => {
                            const deposit = document.getElementById(`deposito-${num}`);
                            if (deposit) {
                                deposit.classList.add('clicked');
                            }
                        });
                    }
                }
            });
        }

        // Função para salvar os dados no Firebase
        function salvarDados() {
            const numerosSelecionados = [];
            document.querySelectorAll('.deposit.clicked').forEach(deposit => {
                const numero = parseInt(deposit.textContent, 10);
                numerosSelecionados.push(numero);
            });

            const dados = {
                total: totalDepositado,
                numerosSelecionados: numerosSelecionados
            };

            const depositosRef = ref(database, 'depositos');
            set(depositosRef, dados); // Salva os dados no Firebase
        }

        // Função para criar os depósitos na tela
        function criarDepositos() {
            const container = document.querySelector('.deposits-container');
            
            // Limpar o container antes de adicionar os depósitos
            container.innerHTML = ''; 

            for (let i = 1; i <= 100; i++) {
                const deposit = document.createElement('div');
                deposit.classList.add('deposit');
                deposit.textContent = i;
                deposit.id = `deposito-${i}`;  // Atribui um id único ao número
                
                deposit.addEventListener('click', () => {
                    if (deposit.classList.contains('clicked')) {
                        // Se já estiver selecionado, desmarca
                        deposit.classList.remove('clicked');
                        totalDepositado -= i;
                    } else {
                        // Se não estiver selecionado, marca
                        deposit.classList.add('clicked');
                        totalDepositado += i;
                    }
                    atualizarTotal();
                    salvarDados(); // Salva os dados sempre que um número é clicado
                });
                
                container.appendChild(deposit);
            }
        }

        // Função para atualizar o valor total
        function atualizarTotal() {
            const totalElement = document.getElementById('total');
            totalElement.textContent = totalDepositado.toFixed(2);
        }

        // Função para resetar os depósitos
        function resetarDepositos() {
            totalDepositado = 0;
            atualizarTotal();
            // Remover as classes "clicked" de todos os depósitos
            document.querySelectorAll('.deposit').forEach(deposit => {
                deposit.classList.remove('clicked');
            });
            salvarDados(); // Salva a alteração no Firebase
        }

        // Criar os depósitos e carregar os dados do Firebase
        criarDepositos();
        carregarDados();

        // Adicionar evento para o botão de reset
        document.getElementById('resetButton').addEventListener('click', resetarDepositos);
    </script>
</body>
</html>
